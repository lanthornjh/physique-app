<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physique Architect | Ultimate Edition</title>
    <style>
        :root { --primary: #455a64; --accent: #81c784; --bg: #cfd8dc; --text: #263238; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 15px; color: var(--text); }
        .card { background: #ffffff; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 650px; border-top: 8px solid var(--primary); }
        
        h2 { text-align: center; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #78909c; font-size: 0.85rem; margin-bottom: 20px; }
        
        .export-tools { display: flex; gap: 8px; margin-bottom: 20px; }
        .btn-tool { flex: 1; padding: 10px; border: none; border-radius: 8px; font-size: 0.8rem; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }

        .input-row { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .input-group { flex: 1; min-width: 110px; }
        label { display: block; font-size: 0.65rem; font-weight: 800; color: #546e7a; text-transform: uppercase; margin-bottom: 3px; }
        input, select { width: 100%; padding: 10px; border: 2px solid #eceff1; border-radius: 8px; font-size: 0.9rem; box-sizing: border-box; }
        
        .checkbox-group { display: flex; align-items: center; gap: 10px; background: #f0f4f7; padding: 10px; border-radius: 8px; margin-top: 5px; height: 42px; box-sizing: border-box; }
        .checkbox-group input { width: auto; cursor: pointer; margin: 0; }
        .checkbox-group label { margin: 0; cursor: pointer; font-size: 0.75rem; color: var(--primary); }

        .info-link { display: inline-block; width: 14px; height: 14px; background: #90a4ae; color: white; border-radius: 50%; text-align: center; line-height: 14px; font-size: 10px; text-decoration: none; margin-left: 4px; }

        .status-box { background: #37474f; color: #eceff1; padding: 18px; border-radius: 10px; margin: 20px 0; border-left: 5px solid var(--accent); display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem; }
        .macro-val { font-weight: 800; color: var(--accent); }

        .action-toolbar { display: flex; gap: 10px; margin-bottom: 20px; align-items: stretch; }
        .unit-select { flex: 1; border: 2px solid #eceff1; border-radius: 8px; font-weight: 700; color: #546e7a; cursor: pointer; }
        .btn-main { flex: 2; background: var(--primary); color: white; padding: 14px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; text-transform: uppercase; }
        
        .cat-label { margin-top: 25px; font-weight: 800; color: var(--primary); text-transform: uppercase; font-size: 0.85rem; border-left: 4px solid var(--accent); padding-left: 10px; }
        .meal-card { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 12px; padding: 18px; margin-top: 10px; }
        .meal-card.locked { border: 2px solid var(--accent); background: #f1f8f1; }
        .meal-card.supplement { background: #e8f5e9; border: 1px dashed var(--accent); }
        
        .meal-title { font-weight: 800; font-size: 1.05rem; color: #37474f; border-bottom: 2px solid #eceff1; padding-bottom: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .ing-box { font-size: 0.9rem; margin-bottom: 4px; }
        .qty { color: #2d5a27; font-weight: 800; }
        .prep-box { font-size: 0.8rem; background: #eceff1; padding: 12px; border-radius: 6px; color: #546e7a; font-style: italic; margin-top: 12px; border-left: 3px solid #cfd8dc; line-height: 1.4; }
        
        .controls { display: flex; gap: 8px; margin-top: 12px; }
        .btn-c { flex: 1; background: white; border: 1px solid #cfd8dc; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600; }
        .btn-c.l-active { background: var(--accent); color: white; border-color: var(--accent); }

        .flavor-guide { background: #37474f; color: white; padding: 15px; border-radius: 10px; margin-top: 30px; font-size: 0.8rem; }
        @media print { .export-tools, .action-toolbar, .controls, .input-row, .checkbox-group { display: none !important; } .card { box-shadow: none; border: none; } }
    </style>
</head>
<body>

<div class="card">
    <div class="export-tools">
        <button class="btn-tool" style="background:#ef5350" onclick="window.print()">üìÑ Save PDF</button>
        <button class="btn-tool" style="background:#4285f4" onclick="exportToDoc()">üìù Google Doc</button>
        <button class="btn-tool" style="background:#546e7a" onclick="copyToClipboard()">üìã Copy Text</button>
    </div>

    <h2>Physique Architect</h2>
    <div class="subtitle">Ultimate Edition: Full Plan with Custom Logic</div>

    <div class="input-row">
        <div class="input-group"><label>Name</label><input type="text" id="userName" placeholder="Architect" oninput="updateAll()"></div>
        <div class="input-group">
            <label>Gender</label>
            <select id="gender" onchange="updateAll()">
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
        </div>
        <div class="input-group"><label>Age</label><input type="number" id="age" value="30" oninput="updateAll()"></div>
        <div class="input-group"><label>Ft</label><input type="number" id="ft" value="5" oninput="updateAll()"></div>
        <div class="input-group"><label>In</label><input type="number" id="in" value="10" oninput="updateAll()"></div>
    </div>

    <div class="input-row">
        <div class="input-group"><label>Weight (lbs)</label><input type="number" id="weight" value="180" oninput="updateAll()"></div>
        <div class="input-group"><label>Goal (lbs)</label><input type="number" id="goal" value="170" oninput="updateAll()"></div>
        <div class="input-group"><label>Weeks</label><input type="number" id="weeks" value="10" oninput="updateAll()"></div>
        <div class="input-group" style="flex:2">
            <label>Activity</label>
            <select id="activity" onchange="updateAll()">
                <option value="1.2">Baseline (0 days)</option>
                <option value="1.375">Light (1-2 days)</option>
                <option value="1.55" selected>Moderate (3-5 days)</option>
                <option value="1.725">High (6-7 days)</option>
                <option value="1.9">Elite (2x daily)</option>
            </select>
        </div>
    </div>

    <div class="input-row">
        <div class="input-group">
            <label>Protein Target <a href="#" class="info-link">!</a></label>
            <select id="pMode" onchange="updateAll()">
                <option value="auto">Auto (1g/lb)</option>
                <option value="custom">Manual Entry</option>
            </select>
        </div>
        <div class="input-group" id="customPContainer" style="display:none;">
            <label>Custom Total (g)</label>
            <input type="number" id="customP" value="180" oninput="updateAll()">
        </div>
        <div class="input-group">
             <div class="checkbox-group">
                 <input type="checkbox" id="addShake" onchange="updateAll()">
                 <label for="addShake">Add Shake?</label>
             </div>
        </div>
    </div>

    <div class="input-row" id="shakeMacroContainer" style="display:none; background: #f1f8f1; padding: 10px; border-radius: 8px; border: 1px solid var(--accent);">
        <div class="input-group"><label>Shake Protein (g)</label><input type="number" id="shakeP" value="25" oninput="updateAll()"></div>
        <div class="input-group"><label>Shake Calories</label><input type="number" id="shakeCal" value="120" oninput="updateAll()"></div>
    </div>

    <div id="statusReport" class="status-box">Enter stats to view report.</div>

    <div class="action-toolbar">
        <select id="unitMode" class="unit-select" onchange="updateAll()">
            <option value="grams">üìè Grams</option>
            <option value="cups">ü•§ Cups</option>
        </select>
        <button class="btn-main" onclick="randomizeAll()">Shuffle Unlocked</button>
    </div>
    
    <div id="menuContainer"></div>

    <div class="flavor-guide">
        <h4>Flavor Guide</h4>
        <b>Mexican:</b> Cumin, Smoked Paprika, Lime. | <b>Italian:</b> Oregano, Basil, Red Pepper. | <b>Asian:</b> Ginger, Garlic, Soy.
    </div>
</div>

<script>
const db = {
    breakfast: [
        { name: "Power Oats & Eggs", p: "Whole Eggs", c: "Dry Oats", v: "Spinach", prep: "Scramble eggs. Prepare oats with water/cinnamon.", pD: 6, cD: 0.4 },
        { name: "Greek Yogurt Bowl", p: "Greek Yogurt", c: "Mixed Berries", v: "Flax Seeds", prep: "Top yogurt with berries and seeds.", pD: 0.1, cD: 0.15 },
        { name: "Architect Pancakes", p: "Whey Protein", c: "Mashed Banana", v: "Egg Whites", prep: "Blend all and cook on non-stick skillet.", pD: 25, cD: 0.25 }
    ],
    lunch: [
        { name: "Lemon Garlic Chicken", p: "Chicken Breast", c: "Cooked Rice", v: "Steamed Broccoli", prep: "Pan-sear seasoned chicken. Serve with rice/veg.", pD: 0.31, cD: 0.28 },
        { name: "Lean Taco Bowl", p: "93/7 Ground Beef", c: "Cooked Rice", v: "Peppers & Onions", prep: "Brown beef with cumin. Saut√© veggies.", pD: 0.26, cD: 0.28 },
        { name: "Turkey Power Plate", p: "Ground Turkey", c: "Quinoa", v: "Zucchini", prep: "Cook turkey with herbs. Serve with quinoa.", pD: 0.27, cD: 0.22 }
    ],
    dinner: [
        { name: "Atlantic Salmon", p: "Salmon Fillet", c: "Sweet Potato", v: "Asparagus", prep: "Bake salmon 15m at 400F. Microwave potato.", pD: 0.22, cD: 0.20 },
        { name: "Steakhouse Plate", p: "Sirloin Steak", c: "Baked Potato", v: "Green Beans", prep: "Grill steak. Bake and fluff potato.", pD: 0.27, cD: 0.20 },
        { name: "White Fish Stir-Fry", p: "Cod or Tilapia", c: "Rice Noodles", v: "Mixed Stir-fry Veg", prep: "Saut√© fish chunks. Toss with boiled noodles.", pD: 0.20, cD: 0.25 }
    ]
};

// State initialized for 2 Breakfasts, 2 Lunches, 3 Dinners
let state = { 
    b: [0, 1], 
    l: [0, 1], 
    d: [0, 1, 2], 
    locks: { 
        b: [false, false], 
        l: [false, false], 
        d: [false, false, false] 
    } 
};

function updateAll() {
    const w = parseFloat(document.getElementById('weight').value) || 0;
    const g = parseFloat(document.getElementById('goal').value) || 0;
    const weeks = parseFloat(document.getElementById('weeks').value) || 0;
    const age = parseFloat(document.getElementById('age').value) || 30;
    const ft = parseFloat(document.getElementById('ft').value) || 5;
    const inch = parseFloat(document.getElementById('in').value) || 10;
    const act = parseFloat(document.getElementById('activity').value);
    const gender = document.getElementById('gender').value;
    const unit = document.getElementById('unitMode').value;
    const pMode = document.getElementById('pMode').value;
    const hasShake = document.getElementById('addShake').checked;
    
    document.getElementById('customPContainer').style.display = (pMode === 'custom') ? 'block' : 'none';
    document.getElementById('shakeMacroContainer').style.display = hasShake ? 'flex' : 'none';

    if (w > 0) {
        const hCm = (ft * 30.48) + (inch * 2.54);
        let bmr = (10 * (w / 2.205)) + (6.25 * hCm) - (5 * age);
        bmr = (gender === 'male') ? bmr + 5 : bmr - 161;
        const tdee = bmr * act;
        
        let targetCal = tdee;
        if (g !== w && weeks > 0) targetCal = tdee + ((g - w) * 3500 / (weeks * 7));
        else if (g < w) targetCal -= 500;
        
        targetCal = Math.max(targetCal, 1200);

        let totalP = (pMode === 'custom') ? (parseFloat(document.getElementById('customP').value) || w) : (g || w);
        let sP = hasShake ? (parseFloat(document.getElementById('shakeP').value) || 25) : 0;
        let sCal = hasShake ? (parseFloat(document.getElementById('shakeCal').value) || 120) : 0;

        const fat = (targetCal * 0.25) / 9;
        const totalC = (targetCal - (totalP * 4) - (fat * 9)) / 4;
        
        document.getElementById('statusReport').innerHTML = `
            <div>CALORIES: <span class="macro-val">${Math.round(targetCal)}</span></div>
            <div>PROTEIN: <span class="macro-val">${Math.round(totalP)}g</span></div>
            <div>CARBS: <span class="macro-val">${Math.round(totalC)}g</span></div>
            <div>FAT: <span class="macro-val">${Math.round(fat)}g</span></div>
        `;

        // Calculate portions based on a 3-meal distribution (average of the display slots)
        renderGrid((totalP - sP)/3, (totalC - (hasShake ? 2 : 0))/3, unit, hasShake, sP, sCal);
    }
}

function renderGrid(p, c, unit, hasShake, sP, sCal) {
    let html = '';
    
    if (hasShake) {
        html += `<div class="cat-label">Daily Supplement</div><div class="meal-card supplement"><b>Protein Shake:</b> ${sP}g Protein | ${sCal} Cal | ~2g Carb</div>`;
    }

    const secs = [
        {id:'b', l:'Breakfast Options (Choose One)', k:'breakfast', list:state.b}, 
        {id:'l', l:'Lunch Options (Choose One)', k:'lunch', list:state.l}, 
        {id:'d', l:'Dinner Options (Choose One)', k:'dinner', list:state.d}
    ];

    secs.forEach(s => {
        html += `<div class="cat-label">${s.l}</div>`;
        s.list.forEach((idx, i) => {
            const m = db[s.k][idx];
            const lk = state.locks[s.id][i];
            
            let pDisp = unit === 'grams' ? Math.round(p/m.pD)+'g' : convertToCups(p, m.p);
            let cDisp = unit === 'grams' ? Math.round(c/m.cD)+'g' : convertToCups(c, m.c);

            html += `<div class="meal-card ${lk?'locked':''}">
                <div class="meal-title"><span>${m.name}</span><span>${lk?'üîí':''}</span></div>
                <div class="ing-box"><b>Protein Source:</b> <span class="qty">${pDisp}</span> ${m.p}</div>
                <div class="ing-box"><b>Carb Source:</b> <span class="qty">${cDisp}</span> ${m.c}</div>
                <div class="ing-box"><b>Veggie:</b> <span class="qty">1.5 Cups</span> ${m.v}</div>
                <div class="prep-box"><b>Instructions:</b> ${m.prep}</div>
                <div class="controls">
                    <button class="btn-c" onclick="swap('${s.id}',${i})">‚Üª Swap</button>
                    <button class="btn-c ${lk?'l-active':''}" onclick="lkS('${s.id}',${i})">${lk?'Unlock':'Save'}</button>
                </div>
            </div>`;
        });
    });
    document.getElementById('menuContainer').innerHTML = html;
}

function convertToCups(g, t) {
    if (t.includes("Eggs")) return Math.max(1, Math.round(g/6)) + " Whole";
    if (t.includes("Rice")) return (g/28/5.5).toFixed(1) + " Cups";
    if (t.includes("Oats")) return (g/0.4/80).toFixed(1) + " Cups";
    if (t.includes("Chicken")||t.includes("Beef")||t.includes("Turkey")) return (g/0.31/140).toFixed(1) + " Cups";
    if (t.includes("Yogurt")) return (g/0.1/240).toFixed(1) + " Cups";
    return Math.round(g) + "g";
}

function swap(c, i) { 
    const k = c==='b'?'breakfast':c==='l'?'lunch':'dinner'; 
    state[c][i] = (state[c][i]+1)%db[k].length; 
    updateAll(); 
}

function lkS(c, i) { 
    state.locks[c][i] = !state.locks[c][i]; 
    updateAll(); 
}

function randomizeAll() { 
    ['b','l','d'].forEach(c => state[c].forEach((_,i) => { if(!state.locks[c][i]) swap(c,i) })); 
}

function copyToClipboard() { 
    const content = document.getElementById('menuContainer').innerText;
    navigator.clipboard.writeText("PHYSIQUE ARCHITECT PLAN\n\n" + content); 
    alert("Plan copied to clipboard!"); 
}

function exportToDoc() { 
    const content = document.getElementById('menuContainer').innerText;
    const b = new Blob([content], {type:'application/msword'}); 
    const a = document.createElement('a'); 
    a.href = URL.createObjectURL(b); 
    a.download = 'Physique_Architect_Plan.doc'; 
    a.click(); 
}

window.onload = updateAll;
</script>
</body>
</html>
